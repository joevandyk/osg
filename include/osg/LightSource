/* -*-c++-*- OpenSceneGraph - Copyright (C) 1998-2003 Robert Osfield 
 *
 * This library is open source and may be redistributed and/or modified under  
 * the terms of the OpenSceneGraph Public License (OSGPL) version 0.0 or 
 * (at your option) any later version.  The full license is in LICENSE file
 * included with this distribution, and on the openscenegraph.org website.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the 
 * OpenSceneGraph Public License for more details.
*/

#ifndef OSG_LIGHTSOURCE
#define OSG_LIGHTSOURCE 1

#include <osg/NodeVisitor>
#include <osg/Light>
#include <osg/Group>

namespace osg {

/** Leaf Node for defining a light in the scene.*/
class SG_EXPORT LightSource : public Group
{
    public:
    
        LightSource();

        LightSource(const LightSource& ls, const CopyOp& copyop=CopyOp::SHALLOW_COPY):
            Group(ls,copyop),
            _value(ls._value),
            _light(dynamic_cast<osg::Light*>(copyop(ls._light.get()))) {}

        META_Node(osg, LightSource);

        enum ReferenceFrame
        {
            RELATIVE_TO_PARENTS,
            RELATIVE_TO_ABSOLUTE
        };
        
        /** Set the light sources's ReferenceFrame, either to be relative to its
          * parent reference frame, or relative to an absolute coordinate
          * frame. RELATIVE_TO_PARENTS is the default.
          * Note: setting the ReferenceFrame to be RELATIVE_TO_ABSOLUTE will
          * also set the CullingActive flag on the light source, and hence all
          * of its parents, to false, thereby disabling culling of it and
          * all its parents.  This is neccessary to prevent inappropriate
          * culling, but may impact cull times if the absolute light source is
          * deep in the scene graph.  It is therefore recommend to only use
          * absolute light source at the top of the scene. */
        void setReferenceFrame(ReferenceFrame rf);
        
        ReferenceFrame getReferenceFrame() const { return _referenceFrame; }

        /** Set the attached light.*/
        void setLight(Light* light);

        /** Get the attached light.*/
        inline Light* getLight() { return _light.get(); }

        /** Get the const attached light.*/
        inline const Light* getLight() const { return _light.get(); }

        /** Set the GLModes on StateSet associated with the LightSource.*/
        void setStateSetModes(StateSet&,StateAttribute::GLModeValue) const;

        /** Set up the local StateSet */
        void setLocalStateSetModes(StateAttribute::GLModeValue=StateAttribute::ON);

    protected:

        virtual ~LightSource();

        virtual bool computeBound() const;

        StateAttribute::GLModeValue     _value;
        ref_ptr<Light>                  _light;

        ReferenceFrame                  _referenceFrame;
};

}

#endif
